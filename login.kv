#:import sp kivy.metrics.sp
#:import dp kivy.metrics.dp
#:import CoreLabel kivy.core.text.Label
#:import Factory kivy.factory.Factory
<UpdatableListingContainer>:
    id: outer_container
    container: container
    load_sign: load_sign
    scroll_view: scroll_view
    StencilView:
        id: refresh_container
        size_hint: None, None
        size: (scroll_view.size[0],abs(scroll_view.min__overscroll))
        pos: (scroll_view.x,scroll_view.y+scroll_view.height-self.height)

        LoadSign:
            id: load_sign
            size_hint: None, None
            body_clr: (0,0,0,0)
            dot1_clr: (59/255, 85/255, 158/255, 1)
            dot2_clr: (129/255, 190/255, 247/255, 1)
            dot3_clr: (59/255, 85/255, 158/255, 1)
            dot_spacing: "50dp"
            pos: (self.parent.x+(scroll_view.width-self.width)/2,self.parent.y-scroll_view.min__overscroll)
            height: abs(scroll_view.min__overscroll)
            scroll_view: scroll_view
            
                
    UpdatableScrollView:
        id: scroll_view
        size_hint: None, None
        size: self.parent.size
        pos: self.parent.pos
        min__overscroll: dp(-100)
        HighPerformanceContainer:
            id: container
            app: app
            child_args: (app,)
            size_hint_y: None
            height: self.minimum_height

<Track>:
    on_release: self.play()

    TrackImage:
        id: title
        pos: (self.parent.x + self.parent.offset, self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        source: self.parent.title

    Label:
        id: artist
        pos: (title.x + title.width + self.parent.offset,title.y + dp(4))
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.artist
        font_size: "16sp"
        color: (0,0,0,1)
        shorten: True
        shorten_from: "right"
        
    Label:
        id: song
        pos: (title.x + title.width + self.parent.offset,title.y + title.height - dp(4) - self.height)
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.song
        font_size: "16sp"
        color: (0.46,0.46,0.46,1)
        shorten: True
        shorten_from: "right"

    TrackAtion:
        id: action
        pos: (self.parent.x + self.parent.width - self.parent.height,self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        on_release: self.open_edit_menu()

<VKTrack>:
    on_release: self.play()

    TrackImage:
        id: title
        pos: (self.parent.x + self.parent.offset, self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        source: self.parent.title

    Label:
        id: artist
        pos: (title.x + title.width + self.parent.offset,title.y + dp(4))
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.artist
        font_size: "16sp"
        color: (0,0,0,1)
        shorten: True
        shorten_from: "right"
        
    Label:
        id: song
        pos: (title.x + title.width + self.parent.offset,title.y + title.height - dp(4) - self.height)
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.song
        font_size: "16sp"
        color: (0.46,0.46,0.46,1)
        shorten: True
        shorten_from: "right"

    VKTrackAtion:
        id: action
        pos: (self.parent.x + self.parent.width - self.parent.height,self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        on_release: self.download()
                
<TrackWithCheckBox>:
    on_release: self.select(action)

    TrackImage:
        id: title
        pos: (self.parent.x + self.parent.offset, self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        source: self.parent.title

    Label:
        id: artist
        pos: (title.x + title.width + self.parent.offset,title.y + dp(4))
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.artist
        font_size: "16sp"
        color: (0,0,0,1)
        shorten: True
        shorten_from: "right"
        
    Label:
        id: song
        pos: (title.x + title.width + self.parent.offset,title.y + title.height - dp(4) - self.height)
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.song
        font_size: "16sp"
        color: (0.46,0.46,0.46,1)
        shorten: True
        shorten_from: "right"

    CheckBox:
        id: action
        pos: (self.parent.x + self.parent.width - self.parent.height,self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        background_checkbox_down: './icons/checkbox_active.png'
        background_checkbox_normal: './icons/checkbox.png'
                
<NoAvailableTracks>:
    size_hint_y: None
    height: "72dp"
    Image:
        id: title
        pos: (self.parent.x + dp(5), self.parent.y + dp(5))
        size: (self.parent.height-dp(10), self.parent.height-dp(10))
        size_hint: (None,None)
        source: "./icons/sadness.png"

    Label:
        pos: (title.x + title.width + dp(25),title.y + (title.height - self.height)/2)
        size_hint: (None,None)
        text: 'No available tracks'
        font_size: "16sp"
        color: (0,0,0,1)

<Tool>:
    on_release: self._do()
    Image:
        id: title
        pos: (self.parent.x + self.parent.offset, self.parent.y + self.parent.offset)
        size: (self.parent.height-2*self.parent.offset, self.parent.height-2*self.parent.offset)
        size_hint: (None,None)
        source: self.parent.title

    Label:
        id: label_name
        pos: (title.x + title.width + self.parent.offset,self.parent.y + (self.parent.height - self.height)/2)
        size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],"20dp")
        text_size: (self.parent.size[0]-4*self.parent.offset-2*title.size[0],dp(20))
        size_hint: (None,None)
        text: self.parent.text
        font_size: "16sp"
        color: (0,0,0,1)
        shorten: True
        shorten_from: "right"
        


<SelectionBottomMenu>:
	id: selection_row
    md_bg_color: app.main_clr
    height:"145dp"
    size_hint: 1,None
    MDRelativeLayout:
		Button:
        	id: create_album
        	background_normal: "./icons/album60.png"
        	size_hint: (None,None)
        	size: (60,60)
        	pos_hint: {'center_x':0.5, 'center_y':0.75}
            on_release: root.create_album()

    MDRelativeLayout:
    	Button:
        	id: delete_selected
        	size_hint: (None,None)
        	pos_hint: {'center_x':0.5, 'center_y':0.75}
        	size: (60,60)
        	background_normal: "./icons/bin60.png"
            on_release: root.delete_selected()

    MDRelativeLayout:
		Button:
        	id: close_menu
        	size_hint: (None,None)
        	pos_hint: {'center_x':0.5, 'center_y':0.75}
        	size: (60,60)
        	background_normal: "./icons/x60.png"
            on_release: root.close_selection()



<AudioInfo>:
	id: audio_row
	orientation: 'vertical'
    height:"95dp"
    size_hint: .96,None

	MDBoxLayout:
		height:"90dp"
        canvas.before:
            Color:
                rgba: app.main_clr2
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [dp(22),]

            Color:
                rgba: app.main_clr
            Line:
                width: dp(1.5)
                rounded_rectangle: (self.x, self.y, self.width, self.height, dp(22))

        MDRelativeLayout:
            size: ("70dp", "90dp")
            size_hint: (None,None)
		    Button:
                id: action
        	    background_color: 0,0,0,0

            Image:
                id: song_status
                size: ("60dp", "60dp")
                size_hint: (None,None)
                source: "./icons/play.png"
                pos_hint: {'center_x':0.5, 'center_y':0.5}


        Ticker:
            id: ticker
            data: {'text': "Artist - song", 'font_size':'20sp'}
            divider: "30dp"
            fit_size: True

            Button:
                id: song_name
                on_release: app.screen_container.open_screen()
                background_color: 0,0,0,0
                    
			
		Button:
			id: song_timer
			on_press: app.screen_container.open_screen()
			size_hint: None,None
			background_color: 0,0,0,0
			size: "70dp","90dp"
			text: "00:00"
            font_size: '20sp'
			haling: "right"
            canvas.before:

                Color:
                    rgba: (0,0,0,0)  # visual feedback of press

                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [0,dp(22),dp(22),0]
                Color:
                    rgba: app.main_clr
                Line:
                    width: dp(1.5)
                    points: self.pos[0],self.pos[1],self.pos[0],self.pos[1]+self.height

	MDProgressBar:
		id: song_progress
		size_hint_y:None
		height:"5dp"
		max: 1
		value: 1

<Album>
    canvas.before:
        Color:
            rgba: app.load_clr

        Rectangle:
            pos: self.pos
            size: self.size

    FloatLayout:
        id: album_header
        orientation: "vertical"
        size_hint: 1, None
        height: "180dp"
        pos: root.pos[0],root.top-self.height - menu_row.height
        canvas.before:
            Color:
                rgba: app.main_clr2
            Rectangle:
                pos: self.pos
                size: self.size

            Color:
                rgba: (0,0,0,1)

            Line:
                points: self.pos[0],self.pos[1],self.pos[0]+self.width,self.pos[1]
                width: dp(2)

            Color:
                rgba: (0,0,0,1)

            Line:
                points: self.pos[0],self.top,self.pos[0]+self.width,self.top
                width: dp(2)

        AsyncImage:
            id: album_image
            size_hint: (None,None)
            fit_mode: 'fill'
            size: self.parent.height - dp(4),self.parent.height - dp(4)
            pos: self.parent.pos[0],self.parent.pos[1]+dp(2)

        Label:
            id: album_name
            text: ""
            font_size: '25sp'
            color: (0,0,0,1)
            pos: album_image.right + dp(20), self.parent.top - self.height - dp(20)
            size: (self.parent.size[0]-album_image.size[0] - dp(50),"25dp")
            text_size: (self.parent.size[0]-album_image.size[0] - dp(50),dp(25))
            size_hint: (None,None)
            shorten: True
            shorten_from: "right"

        Label:
            id: count
            text: str(0) + " track in album"
            font_size: '14sp'
            color: (0,0,0,1)
            pos: album_image.right + dp(20), self.parent.pos[1] + dp(20)
            size: (self.parent.size[0]-album_image.size[0] - dp(50),"20dp")
            text_size: (self.parent.size[0]-album_image.size[0] - dp(50),dp(20))
            size_hint: (None,None)
            shorten: True
            shorten_from: "right"
            
    MDRelativeLayout:
        id: menu_row
        orientation: "vertical"
        height: "100dp"
        size_hint: 1, None
        pos: self.parent.pos[0], self.parent.top-self.height
        md_bg_color: app.main_clr

    UpdatableListingContainer:
        id: container
        header: album_header
        size_hint: 1, None
        height: root.size[1]-menu_row.height
        pos: self.parent.pos[0], album_header.pos[1] - self.height - dp(2)
        overscroll_callback: (root.force_screen_update,(),{})


<AlbumList>
	MDBoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: app.load_clr

            Rectangle:
                pos: self.pos
                size: self.size
        MDRelativeLayout:
            id: menu_row
            orientation: "vertical"
            size: (root.size[0],"100dp")
            size_hint: (None,None)
            pos_hint: {'center_x':0.5, 'center_y':0.95}
            md_bg_color: app.main_clr


        UpdatableListingContainer:
            id: container
            overscroll_callback: (root.force_screen_update,(),{})


<Login>:
    MDBoxLayout:
        id: login_container
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: app.main_clr2

            Rectangle:
                pos: self.pos
                size: self.size

        MDRelativeLayout:
            id: menu_row
            orientation: "vertical"
            size: (root.size[0],"100dp")
            size_hint: (None,None)
            pos_hint: {'center_x':0.5, 'center_y':0.95}
            md_bg_color: app.main_clr

            MDRelativeLayout:
                size: ("40dp","40dp")
                size_hint: (None,None)
                pos_hint: {'center_x':0.1, 'center_y':0.35} 

                Image:
                    pos_hint: {'center_x':0.5, 'center_y':0.5} 
                    source: "./icons/back.png"
                    size: ("40dp","40dp")
                    size_hint: (None,None)
                Button:
                    background_color: 0,0,0,0
                    pos_hint: {'center_x':0.5, 'center_y':0.5} 
                    size: ("60dp","60dp")
                    size_hint: (None,None)
                    on_release: root.close_login_page()
            
        MDRelativeLayout:
            Image:
            	id: login_img
    			size: ("80dp","80dp")
                size_hint: (None,None)
                source: ""
                pos_hint: {'center_x':0.5, 'center_y':0.81}


            MDTextField:
            	id: login
            	multiline:False
                hint_text: "Phone"
            	font_size:'32sp'
    			pos_hint:{'center_x':0.5, 'center_y':0.7}
    			size: (root.size[0]*0.8,"100dp")
                size_hint: (None,None)

            MDTextField:
            	id: password
            	multiline:False
                hint_text: "Password"
            	font_size:'32sp'
    			pos_hint:{'center_x':0.5, 'center_y':0.55}
    			size: (root.size[0]*0.8,"100dp")
                size_hint: (None,None)
            Label:
            	id: error
            	text:'fdsfds123dgbdfbdgffdgfdg'
            	font_size:'18sp'
                size_hint: (None,None)
                size: self.texture_size
            	pos: (password.pos[0]+dp(10),password.pos[1]-self.size[1])
                haling: "left"
            	color: app.err_text_clr

            MDRelativeLayout:
                id: action



<PopupBody>:
    orientation: "vertical"
    size: root.width, root.height
    canvas.before:

        Color:
            rgba: 1, 1, 1, 1

        RoundedRectangle:
            pos: self.x - dp(20), self.y - dp(20)
            size: self.width + dp(40), self.height + dp(60)
            radius: [dp(10)]

        Color:
            rgba: app.main_clr2

        RoundedRectangle:
            pos: self.x - dp(20), self.y + self.height - dp(20)
            size: self.width + dp(40), dp(60)
            radius: [dp(10),dp(10),0,0]

        Color:
            rgba: app.main_clr
        Line:
            width: dp(1)
            points: self.x - dp(20),self.y + self.height - dp(20),self.x + self.width + dp(20),self.y + self.height - dp(20)

        Color:
            rgba: app.main_clr
        Line:
            width: dp(2)
            rounded_rectangle: (self.x - dp(20), self.y - dp(20), self.width + dp(40), self.height + dp(60), dp(10))

<PopupActionButton>:
    size: ("120dp","50dp")
    size_hint: (None,None)
    pos_hint: {"center_y": 0.22}
    MDRelativeLayout:
        canvas.before:
            Color:
                rgba: app.main_clr2

            RoundedRectangle:
                pos: self.pos
                size: self.width, self.height
                radius: [dp(5)]

            Color:
                rgba: .5, .5, .5, 1
            Line:
                width: dp(1)
                rounded_rectangle: (self.x, self.y, self.width, self.height,dp(5))

    Label:
        id: text
        text: 'Text'
        color: (0,0,0,1)
        pos_hint: {"center_x": .5, "center_y": 0.5}
        font_size: "18sp"
        halign: "center"

<LoginPopup@Popup>:
    title: ""
    size_hint: (.8,.2)
    separator_height: 0

    PopupBody
        MDRelativeLayout:

            Label:
                text: 'Choose media'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            Image:
                id: vk
                size: ("70dp","70dp")
                size_hint: (None,None)
                source: "./icons/vk.png"
                pos_hint: {'center_y':0.5, 'center_x':0.35}

            Button:
                size: ("70dp","70dp")
                size_hint: (None,None)
                pos_hint: {'center_y':0.5, 'center_x':0.35}
                on_press: app.switch_to_login(root.ids.vk.source, root)
                opacity: 0

            Image:
                id: ya
                size: ("70dp","70dp")
                size_hint: (None,None)
                source:  "./icons/ya.png"
                pos_hint: {'center_y':0.5, 'center_x':0.65}

            Button:
                size: ("70dp","70dp")
                size_hint: (None,None)
                pos_hint: {'center_y':0.5, 'center_x':0.65}
                on_press: app.switch_to_login(root.ids.ya.source, root)
                opacity: 0

<CaptchaPopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.35)
    separator_height: 0
    pos_hint: {'center_y':0.7,'center_x':0.5}
    on_dismiss: 
        self.ids.error.text = ''
        self.ids.captcha_key.text = ''

    PopupBody:
        MDRelativeLayout:
        
            Label:
                text: 'Enter symbols from captcha'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            Image:
        	    id: captcha
			    size: ("130dp","50dp")
                size_hint: (None,None)
                pos_hint: {'center_x':0.5, 'center_y':0.78}
                source: "captcha.jpg"
                canvas.after:
                    Color:
                        rgba: app.main_clr

                    Line:
                        width: dp(1)
                        rectangle: (self.x - dp(1), self.y - dp(1), self.width + dp(2), self.height + dp(2))

            MDTextField:
                id: captcha_key
                multiline:False
                hint_text: "Captcha key"
                font_size:'20sp'
                pos_hint:{'center_x':0.5, 'center_y':0.5}
                width: root.size[0]*0.5
                size_hint_x: None

		    Label:
        	    id: error
        	    text:'error'
        	    font_size:"18sp"
        	    pos_hint: {'center_x':0.5, 'center_y':0.33}
        	    theme_text_color: "Custom"
    		    color: app.err_text_clr
        	    pos: (captcha_key.pos[0]+dp(10),captcha_key.pos[1]-self.size[1])
                haling: "left"

            PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()


<SecureCodePopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.3)
    separator_height: 0
    pos_hint: {'center_y':0.7,'center_x':0.5}
    on_dismiss: 
    	self.ids.error.text = ''
    	self.ids.secure_code.text = ''

    PopupBody:
        MDRelativeLayout:
        
            Label:
                text: 'Enter secure code to email or phone'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            MDTextField:
                id: secure_code
                multiline:False
                hint_text: "Secure code"
                font_size:'20sp'
                pos_hint:{'center_x':0.5, 'center_y':0.65}
                width: root.size[0]*0.5
                size_hint_x: None

            Label:
                id: error
                text:'error'
                font_size:"18sp"
                pos_hint: {'center_x':0.5, 'center_y':0.41}
                color: app.err_text_clr
                pos: (secure_code.pos[0]+dp(10),secure_code.pos[1]-self.size[1])
                haling: "left"

    	    PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()

<CreateAlbumPopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.4)
    separator_height: 0
    pos_hint: {'center_y':0.7,'center_x':0.5}
    on_dismiss: 
        self.ids.cover.source = "./icons/add-img.png"
        self.ids.album_name.text = ''

    PopupBody:
        MDRelativeLayout:
            Label:
                text: 'Create album'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"
            Image:
                id: cover
                source: "./icons/add-img.png"
                pos_hint:{'center_x':0.5, 'center_y':0.75}
                size: ("90dp","90dp")
                size_hint: (None,None)
            Button:
                pos_hint:{'center_x':0.5, 'center_y':0.75}
                size: ("90dp","90dp")
                size_hint: (None,None)
                opacity: 0
                on_release: print(123)

            MDTextField:
                id: album_name
                multiline:False
                hint_text: "Album name"
                font_size:'20sp'
                pos_hint:{'center_x':0.5, 'center_y':0.48}
                width: root.size[0]*0.7
                size_hint_x: None

    	    PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()

<RenameAlbumPopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.3)
    separator_height: 0
    pos_hint: {'center_y':0.7,'center_x':0.5}
    on_dismiss: 
        self.ids.album_name.text = ''

    PopupBody:
        MDRelativeLayout:
            Label:
                text: 'Rename album'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            MDTextField:
        	    id: album_name
                multiline:False
                hint_text: "New album name"
                font_size:'20sp'
                pos_hint:{'center_x':0.5, 'center_y':0.55}
                width: root.size[0]*0.7
                size_hint_x: None

    	    PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()

<RenameTrackPopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.35)
    separator_height: 0
    pos_hint: {'center_y':0.7,'center_x':0.5}
    on_dismiss: 
        self.ids.author.text = ''
        self.ids.song.text = ''

    PopupBody:
        MDRelativeLayout:
            Label:
                text: 'Rename track'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            MDTextField:
                id: author
                multiline:False
                hint_text: "Author"
                font_size:'18sp'
                pos_hint:{'center_x':0.5, 'center_y':0.75}
                width: root.size[0]*0.7
                size_hint_x: None
            MDTextField:
                id: song
                multiline:False
                hint_text: "Song"
                font_size:'18sp'
                pos_hint:{'center_x':0.5, 'center_y':0.5}
                width: root.size[0]*0.7
                size_hint_x: None

            PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()

<AddToAlbumPopup>:
    title: ""
    separator_height: 0
    size_hint: (.9,.5)

    PopupBody:
        MDRelativeLayout:
            Label:
                text: 'Add track to album'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

            MDScrollView:
                size_hint: (1,0.95)
                do_scroll_x: False
                MDList:
                    adaptive_height: True
                    id: container

<ConfirmationPopup>:
    auto_dismiss: False
    title: ""
    size_hint: (.8,.2)
    separator_height: 0
    pos_hint: {'center_x':0.5}
    on_dismiss: 
        self.ids.info.text = ''

    PopupBody:
        MDRelativeLayout:
        
            Label:
        	    id: info
                text: 'Are you sure want to delete album'
                color: (0,0,0,1)
                font_size: "18sp"
                pos_hint: {'center_x':0.5, 'center_y':1.02}
                haling: "center"

    	    PopupActionButton:
                id: action
                pos_hint: {'center_x':0.75}

            PopupActionButton:
                id: cancel
                pos_hint: {'center_x':0.25}
                on_release: root.dismiss()





<Search>:
    MDBoxLayout:
        orientation: "vertical"
        canvas.before:
            Color:
                rgba: app.load_clr

            Rectangle:
                pos: self.pos
                size: self.size

        MDRelativeLayout:
            id: search_row
            orientation: "vertical"
            size: (root.size[0],"105dp")
            size_hint: (None,None)
            pos_hint: {'center_x':0.5, 'center_y':0.95}
            md_bg_color: app.main_clr

            MDRelativeLayout:
                id: back_btn_layout
                pos_hint: {'center_x':0.1,'center_y':.35}
                size: ("50dp","50dp")
                size_hint: (None,None)
                md_bg_color: app.btn_hitbox_clr

                Button:
                    background_color: [0,0,0,0]
                    pos_hint: {'center_x':.5, 'center_y':.5}
                    size: ("50dp","50dp")
                    size_hint: (None,None)
                    on_release: root.close_search()
                Image:
                    pos_hint: {'center_x':.5, 'center_y':.5}
                    size: ("30dp","30dp")
                    size_hint: (None,None)
                    source: "./icons/back.png"


            MDRelativeLayout:
                id: search_input_outer
                pos_hint: {'center_x':0.57,'center_y':.35}
                size: (root.size[0]*0.8,"55dp")
                size_hint: (None,None)

                TextInput:
                    id: search_input
                    multiline: False
                    font_size: '20sp'
                    padding_y: [(self.height)/4, 0]
                    pos_hint: {"center_x": .48,"center_y": .5}
                    size_hint: (None,None)
                    cursor_color: (1,0,0,1)
                    #hint_text: 'Search audio'
                    hint_text_color: (1,1,1,0) if self.focus else (0, 1, 0, 1)
                    background_color: (0,0,0,0)
                    size: (root.size[0]*0.64,"50dp")
                    on_text_validate: root.search(self.text)
                    on_text: root.show_resent(self.text)
                    on_focus: root.show_resent(self.text)

                    canvas.before:
                        Color:
                            rgba: (1, 1, 1, 1) if self.focus else (.9, .9, .9, 1)

                        RoundedRectangle:
                            pos: self.x - (search_input_outer.width -self.width)/2, self.y
                            size: search_input_outer.width, self.height
                            radius: [dp(10)]

                        Color:
                            rgba: (120/255, 120/255, 120/255, .8) if self.focus else (60/255, 60/255, 60/255, .8)
                        Line:
                            width: 2 if self.focus else 1.5
                            rounded_rectangle: (self.x - (search_input_outer.width -self.width)/2, self.y, search_input_outer.width, self.height, dp(10))




                MDRelativeLayout:
                    pos_hint: {"center_x": .92,"center_y": .5}
                    size: ("50dp","50dp")
                    size_hint: (None,None)
                    md_bg_color: app.btn_hitbox_clr
                    Button:
                        background_color: [0,0,0,0]
                        pos_hint: {'center_x':.5, 'center_y':.5}
                        size: ("50dp","50dp")
                        size_hint: (None,None)
                        on_release: root.clean_search()

                    Image:
                        pos_hint: {'center_x':.5, 'center_y':.5}
                        size: ("20dp","20dp")
                        size_hint: (None,None)
                        source: "./icons/x.png"
                        opacity: 1 if search_input.text != '' else 0

                MDRelativeLayout:
                    id: mode_btn_layout
                    pos_hint: {"center_x": .04,"center_y": .5}
                    size: ("50dp","50dp")
                    size_hint: (None,None)
                    md_bg_color: app.btn_hitbox_clr
                    Button:
                        background_color: [0,0,0,0]
                        pos_hint: {'center_x':.5, 'center_y':.5}
                        size: ("50dp","50dp")
                        size_hint: (None,None)
                        on_release: root.switch_search()
                    Image:
                        id: mode_btn_img
                        pos_hint: {'center_x':.5, 'center_y':.5}
                        size: ("30dp","30dp")
                        size_hint: (None,None)
                        source: "./icons/search.png"


        MDBoxLayout:          
            orientation: "vertical"
            size_hint: (None,None)
            size: (root.size[0],root.size[1]-search_row.height)
            UpdatableListingContainer:
                id: container


<Start>:
    canvas.before:
        Color:
            rgba: app.load_clr

        Rectangle:
            pos: self.pos
            size: self.size
        
    BoxLayout:
        id: main_screen_header
        orientation: "vertical"
        size_hint: 1, None
        height: len(self.children)*self.children[0].height if self.children else 0
        pos: root.pos[0],root.top-self.height - menu_row.height - dp(2)
        canvas.before:
            Color:
                rgba: (0,0,0,1)

            Line:
                points: self.pos[0],self.pos[1],self.pos[0]+self.width,self.pos[1]
                width: dp(2)

            Color:
                rgba: (0,0,0,1)

            Line:
                points: self.pos[0],self.top,self.pos[0]+self.width,self.top
                width: dp(2)
            

    MDRelativeLayout:
        id: menu_row
        orientation: "vertical"
        height: "100dp"
        size_hint: (1,None)
        pos: root.pos[0],root.top-self.height
        md_bg_color: app.main_clr

    UpdatableListingContainer:
        id: container
        size_hint: 1, None
        height: root.height - menu_row.height
        pos: root.pos[0],main_screen_header.pos[1] - self.height - dp(2)
        header: main_screen_header
        overscroll_callback: (root.force_screen_update,(),{})


	SideMenu:
		id: nav_drawer
        md_bg_color: app.main_clr
        swipe_edge_width: "50dp"

		ContentNavigationDrawer:
			orientation: 'vertical'

			Image:
                id: logo_img
				size_hint: None, None
		    	size: ("290dp", "75dp")
		    	source: "logo.png"
		    	pos_hint: {"center_x": .5, "center_y": .9}

            MDRelativeLayout:
                id: home_btn_outer
                size_hint: None, None
                size: ("290dp", "75dp")
                pos: (logo_img.pos[0],logo_img.pos[1]-logo_img.size[1]-dp(90))
        	    Button:
                    id: home_btn
            	    size_hint: None, None
		    	    size: ("290dp", "75dp")
				    pos_hint: {"center_x": .5, "center_y": .5}
		    	    background_color: 0, 0, 0, 0
            	    on_release: 
                        app.audio_listing_key = 'user'
                        app.main_screen.audios_listing()
                    canvas.before:
                        Color:
                            rgba: (.77,.77,.77,1)

                        RoundedRectangle:
                            pos: self.x, self.y
                            size: self.width, self.height
                            radius: [dp(6), dp(6),0, 0]


		        Image:
				    size_hint: None, None
		    	    size: ("60dp", "60dp")
		    	    source: "./icons/home.png"
		    	    pos_hint: {"center_x": .12, "center_y": .5}
		        MDLabel:
        		    text: "Loaded Music"
                    font_size: '32sp'
				    pos_hint: {"center_x": .765, "center_y": .5}



            MDScrollView:
                id: accounts_list
                always_overscroll: False
                size: ("290dp", "280dp")
                size_hint: None,None
                pos: (home_btn_outer.pos[0],home_btn_outer.pos[1]-self.size[1])

                canvas.before:
                    Color:
                        rgba: 1, 1, 1, 1

                    Rectangle:
                        pos: self.x, self.y
                        size: self.width, self.height

            	DrawerList:
            		size_hint_y: None
        			height: self.minimum_height

                	MDList:
                		id: session_container
                		adaptive_height: True
                		size_hint_y: None
        				height: self.minimum_height

            MDRelativeLayout:
                id: add_btn_outer
                size_hint: None, None
                size: (accounts_list.size[0], "75dp")
                pos: (accounts_list.pos[0],accounts_list.pos[1]-self.size[1] + dp(3))

        		Button:
            		size_hint: None, None
		    		size: ("290dp", "70dp")
		    		pos_hint: {"center_x": .5, "center_y": .5}
                    background_color: 0, 0, 0, 0
            		on_release: Factory.LoginPopup().open()
                    canvas.before:
                        Color:
                            rgba: (.77,.77,.77,1)

                        RoundedRectangle:
                            pos: self.x, self.y
                            size: self.width, self.height
                            radius: [0,0,dp(6),dp(6)]

                        Color:
                            rgba: 0, 0, 0, 1
                        Line:
                            width: 1.5
                            rounded_rectangle: 
                                (self.x, self.y, self.width, home_btn_outer.top-self.parent.pos[1] - dp(3),dp(6))
		    	Image:
		    		size_hint: None, None
		    		size: ("70dp", "70dp")
		    		source: "./icons/add.png"

		    		pos_hint: {"center_x": .12, "center_y": .5}
		    	MDLabel:
            		text: "Connect account"
                    font_size: '28sp'
            		pos_hint: {"center_x": .745, "center_y": .5}


            Label:
            	text: "Version 0.2 beta"
                font_size: '20sp'
            	size_hint: None, None
            	pos: 
                    (add_btn_outer.pos[0]+(add_btn_outer.size[0]-self.size[0])/2,
                    add_btn_outer.pos[1]-self.size[1])
                color: app.text_clr




<Player>:
	MDRelativeLayout:
		md_bg_color: [0.8,0.9,1,1]
		Button:
        	pos_hint: {'center_x':0.5, 'center_y':1}
            
        	background_color: 0,0,0,0
    		size: (root.size[0],root.size[1]/4.5)
            size_hint: (None,None)
            on_release: root.parent.close_screen()

        Image:
			size: ("60dp","60dp")
            size_hint: (None,None)
            source: "./icons/down.png"
            pos_hint: {'center_x':0.5, 'center_y':0.92}

            
        Ticker:
            id: ticker
            width: root.size[0]*.9
            size_hint: (None,1)
            pos_hint:{'center_x':0.5, 'center_y':.4}
            data: {'text': "Artist - song", 'font_size':'28sp'}
            divider: "30dp"
            fit_size: True

        Label:
        	id: song_timer
        	text: "00:00"
            pos_hint: {'center_x':.14, 'center_y':.3}
            size_hint: (1,1)
            font_size: "20sp"
        Label:
        	id: song_len
        	text: "00:00"
            pos_hint: {'center_x':.86, 'center_y':.3}
            size_hint: (1,1)
            font_size: "20sp"
        MDSlider:
        	id: song_progress
        	orientation: "horizontal"
        	active: False
        	hint_radius: 10
        	min: 0
        	max: 1
        	value: 0

            pos_hint: {'center_x':0.5, 'center_y':0.32}
            size: (root.size[0]*0.9,"25dp")
            size_hint: (None,None)
            on_touch_down:
            	if args[0].collide_point(args[1].x, args[1].y): self.on_touch_up=lambda x: app.player.seek(args)
            	else: self.on_touch_up=lambda x: x

        Image:
            pos_hint: {'center_x':0.2, 'center_y':0.2}
            source: "./icons/left.png"
            size: ("65dp","65dp")
            size_hint: (None,None)

        Button:
        	pos_hint: {'center_x':0.2, 'center_y':0.2}
            size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0
            on_release: app.player.play_next(-1)

        Image:
            id: song_status
            pos_hint: {'center_x':0.5, 'center_y':0.2}
            source: "./icons/play.png"
            size: ("65dp","65dp")
            size_hint: (None,None)

        Button:
            id: action
        	pos_hint: {'center_x':0.5, 'center_y':0.2}
    		size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0

        Image:
            pos_hint: {'center_x':0.8, 'center_y':0.2}
            source: "./icons/right.png"
            size: ("65dp","65dp")
            size_hint: (None,None)

        Button:
        	pos_hint: {'center_x':0.8, 'center_y':0.2}
            size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0
            on_release: app.player.play_next(1)

        Image:
            pos_hint: {'center_x':0.2, 'center_y':0.1}
            source: "./icons/mix.png"
            size: ("50dp","50dp")
            size_hint: (None,None)

        Button:
            pos_hint: {'center_x':0.2, 'center_y':0.1}
            size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0

        Image:
            pos_hint: {'center_x':0.5, 'center_y':0.1}
            source: "./icons/list.png"
            size: ("50dp","50dp")
            size_hint: (None,None)

        Button:
            pos_hint: {'center_x':0.5, 'center_y':0.1}
            size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0

        Image:
            pos_hint: {'center_x':0.8, 'center_y':0.1}
            source: "./icons/repeat.png"
            size: ("50dp","50dp")
            size_hint: (None,None)

        Button:
            pos_hint: {'center_x':0.8, 'center_y':0.1}
            size: ("65dp","65dp")
            size_hint: (None,None)
            opacity: 0